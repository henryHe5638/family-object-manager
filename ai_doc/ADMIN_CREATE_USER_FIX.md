# âœ… ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·å¯†ç åŠ å¯†ä¿®å¤

## é—®é¢˜æè¿°

ç®¡ç†å‘˜åœ¨ç”¨æˆ·ç®¡ç†ç•Œé¢åˆ›å»ºæ–°ç”¨æˆ·åï¼Œæ–°ç”¨æˆ·æ— æ³•ç™»å½•ï¼Œæç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"ã€‚

## æ ¹æœ¬åŸå› 

**åŠ å¯†æµç¨‹ä¸ä¸€è‡´**ï¼š

### é—®é¢˜æµç¨‹
```
ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·:
  å‰ç«¯å‘é€: { password: "123456" }  â† æ˜æ–‡å¯†ç 
  åç«¯å¤„ç†: bcrypt("123456")        â† ç›´æ¥ bcrypt åŠ å¯†
  å­˜å…¥æ•°æ®åº“: $2a$10$...

æ–°ç”¨æˆ·ç™»å½•:
  å‰ç«¯å‘é€: { password: SHA256("123456") }  â† SHA256 åŠ å¯†
  åç«¯éªŒè¯: bcrypt.compare(SHA256("123456"), $2a$10$...)
  ç»“æœ: âŒ ä¸åŒ¹é…ï¼
```

### æ­£ç¡®æµç¨‹
```
ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·:
  å‰ç«¯å‘é€: { password: SHA256("123456") }   â† SHA256 åŠ å¯†
  åç«¯å¤„ç†: bcrypt(SHA256("123456"))        â† å† bcrypt åŠ å¯†
  å­˜å…¥æ•°æ®åº“: $2a$10$...

æ–°ç”¨æˆ·ç™»å½•:
  å‰ç«¯å‘é€: { password: SHA256("123456") }  â† SHA256 åŠ å¯†
  åç«¯éªŒè¯: bcrypt.compare(SHA256("123456"), $2a$10$...)
  ç»“æœ: âœ… åŒ¹é…æˆåŠŸï¼
```

---

## ä¿®å¤æ–¹æ¡ˆ

### 1. å‰ç«¯ï¼šåˆ›å»ºç”¨æˆ·æ—¶åŠ å¯†å¯†ç 

**æ–‡ä»¶**: `/frontend/src/views/Users.vue`

**å¯¼å…¥åŠ å¯†å·¥å…·**:
```typescript
import { encryptPassword } from '../utils/crypto';
```

**ä¿®æ”¹åˆ›å»ºç”¨æˆ·å‡½æ•°**:
```typescript
const createUser = async () => {
  try {
    // å¯¹å¯†ç è¿›è¡Œå®¢æˆ·ç«¯åŠ å¯†
    const userData = {
      ...newUser.value,
      password: encryptPassword(newUser.value.password)
    };
    await authApi.createUser(userData);
    showCreate.value = false;
    newUser.value = { username: '', email: '', password: '', role: 'user' };
    await loadUsers();
  } catch (error) {
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', error);
    alert('åˆ›å»ºç”¨æˆ·å¤±è´¥');
  }
};
```

### 2. åç«¯ï¼šå·²ç»æ­£ç¡®å¤„ç†åŠ å¯†å¯†ç 

**æ–‡ä»¶**: `/backend/src/routes/users.ts`

åç«¯å·²ç»æœ‰æ­£ç¡®çš„æ³¨é‡Šè¯´æ˜ï¼š
```typescript
// å®¢æˆ·ç«¯å·²ç»å¯¹å¯†ç è¿›è¡Œäº† SHA256 åŠ å¯†
// è¿™é‡Œå†ç”¨ bcrypt è¿›è¡ŒäºŒæ¬¡åŠ å¯†å­˜å‚¨
const hashed = await bcrypt.hash(password, 10);
```

è¿™ä¸ªé€»è¾‘é€‚ç”¨äºï¼š
- âœ… ç”¨æˆ·æ³¨å†Œ (`POST /api/users/register`)
- âœ… ç”¨æˆ·ç™»å½•éªŒè¯ (`POST /api/users/login`)
- âœ… ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ· (`POST /api/users`)
- âœ… ç®¡ç†å‘˜é‡ç½®ç”¨æˆ·å¯†ç  (`PUT /api/users/:id`)

---

## å®Œæ•´åŠ å¯†é“¾è·¯

### åœºæ™¯1ï¼šç”¨æˆ·è‡ªå·±æ³¨å†Œ
```
1. ç”¨æˆ·è¾“å…¥: password123
2. å‰ç«¯ SHA256: a3f8c9d2e1...
3. å‘é€åˆ°åç«¯: { password: "a3f8c9d2e1..." }
4. åç«¯ bcrypt: $2a$10$xyz...
5. å­˜å…¥æ•°æ®åº“
6. ç™»å½•éªŒè¯: âœ… æˆåŠŸ
```

### åœºæ™¯2ï¼šç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·ï¼ˆä¿®å¤åï¼‰
```
1. ç®¡ç†å‘˜è¾“å…¥: password123
2. å‰ç«¯ SHA256: a3f8c9d2e1...
3. å‘é€åˆ°åç«¯: { password: "a3f8c9d2e1..." }
4. åç«¯ bcrypt: $2a$10$xyz...
5. å­˜å…¥æ•°æ®åº“
6. ç”¨æˆ·ç™»å½•éªŒè¯: âœ… æˆåŠŸ
```

### åœºæ™¯3ï¼šç®¡ç†å‘˜é‡ç½®å¯†ç 
```
1. ç®¡ç†å‘˜è¾“å…¥æ–°å¯†ç : newpass456
2. å‰ç«¯ SHA256: b2e7d8c3f4...
3. å‘é€åˆ°åç«¯: { password: "b2e7d8c3f4..." }
4. åç«¯ bcrypt: $2a$10$abc...
5. æ›´æ–°æ•°æ®åº“
6. ç”¨æˆ·ç™»å½•éªŒè¯: âœ… æˆåŠŸ
```

### åœºæ™¯4ï¼šåˆå§‹ç®¡ç†å‘˜è´¦å·
```
1. æœåŠ¡å¯åŠ¨æ—¶: "admin123"
2. åç«¯ SHA256: 240be518fa...
3. åç«¯ bcrypt: $2a$10$def...
4. å­˜å…¥æ•°æ®åº“
5. ç™»å½•éªŒè¯: âœ… æˆåŠŸ
```

---

## æµ‹è¯•æ­¥éª¤

### 1. ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·

1. ä½¿ç”¨ `admin/admin123` ç™»å½•
2. è¿›å…¥ç”¨æˆ·ç®¡ç†é¡µé¢
3. ç‚¹å‡»"åˆ›å»ºç”¨æˆ·"æŒ‰é’®
4. è¾“å…¥ç”¨æˆ·ä¿¡æ¯ï¼š
   - ç”¨æˆ·å: `testuser`
   - å¯†ç : `test123456`
   - é‚®ç®±: `test@example.com`
   - è§’è‰²: `user`
5. ç‚¹å‡»"åˆ›å»º"
6. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾
7. **éªŒè¯**: è¯·æ±‚ä½“ä¸­çš„ password å­—æ®µåº”è¯¥æ˜¯ 64 ä½å“ˆå¸Œå€¼

**é¢„æœŸè¯·æ±‚ä½“**:
```json
{
  "username": "testuser",
  "password": "9af15b336e6a9619928537df30b2e6a2376569fcf9d7e773eccede65606529a0",
  "email": "test@example.com",
  "role": "user"
}
```

### 2. æ–°ç”¨æˆ·ç™»å½•æµ‹è¯•

1. é€€å‡ºå½“å‰è´¦å·
2. ä½¿ç”¨æ–°åˆ›å»ºçš„ç”¨æˆ·ç™»å½•ï¼š
   - ç”¨æˆ·å: `testuser`
   - å¯†ç : `test123456`
3. **é¢„æœŸç»“æœ**: âœ… ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ä»ªè¡¨ç›˜

### 3. éªŒè¯æ•°æ®åº“

```bash
cd backend
sqlite3 database.sqlite

# æŸ¥çœ‹æ–°ç”¨æˆ·
SELECT username, role, created_at FROM users WHERE username = 'testuser';

# æŸ¥çœ‹å¯†ç å“ˆå¸Œï¼ˆåº”è¯¥ä»¥ $2a$10$ å¼€å¤´ï¼‰
SELECT substr(password, 1, 7) FROM users WHERE username = 'testuser';
# è¾“å‡ºåº”è¯¥æ˜¯: $2a$10$
```

---

## æ¶‰åŠçš„æ–‡ä»¶

### å‰ç«¯
- âœ… `/frontend/src/views/Users.vue` - æ·»åŠ å¯†ç åŠ å¯†

### åç«¯
- âœ… `/backend/src/routes/users.ts` - å·²æœ‰æ­£ç¡®æ³¨é‡Š
- âœ… `/backend/src/database.ts` - åˆå§‹ç®¡ç†å‘˜å¯†ç åŠ å¯†

### å·¥å…·
- âœ… `/frontend/src/utils/crypto.ts` - SHA256 åŠ å¯†å·¥å…·
- âœ… `/backend/src/utils/crypto.ts` - æœåŠ¡ç«¯å·¥å…·ï¼ˆé¢„ç•™ï¼‰

---

## æ‰€æœ‰å¯†ç åœºæ™¯æ±‡æ€»

| åœºæ™¯ | å‰ç«¯ | åç«¯ | çŠ¶æ€ |
|-----|------|------|-----|
| ç”¨æˆ·æ³¨å†Œ | SHA256 | bcrypt | âœ… |
| ç”¨æˆ·ç™»å½• | SHA256 | bcrypt.compare | âœ… |
| ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ· | SHA256 | bcrypt | âœ… å·²ä¿®å¤ |
| ç®¡ç†å‘˜é‡ç½®å¯†ç  | SHA256 | bcrypt | âœ… |
| åˆå§‹ç®¡ç†å‘˜ | SHA256 | bcrypt | âœ… |

---

## å®‰å…¨æ€§è¯´æ˜

### å½“å‰å®‰å…¨æªæ–½

1. **å®¢æˆ·ç«¯åŠ å¯†** (SHA256)
   - é˜²æ­¢ç½‘ç»œä¼ è¾“ä¸­çš„æ˜æ–‡æ³„éœ²
   - é˜²æ­¢æµè§ˆå™¨å†å²è®°å½•ä¸­çš„æ˜æ–‡
   - é˜²æ­¢æœåŠ¡å™¨æ—¥å¿—ä¸­çš„æ˜æ–‡

2. **æœåŠ¡ç«¯åŠ å¯†** (bcrypt)
   - é˜²æ­¢æ•°æ®åº“æ³„éœ²
   - æ…¢é€Ÿå“ˆå¸Œç®—æ³•é˜²æ­¢æš´åŠ›ç ´è§£
   - æ¯ä¸ªå¯†ç ç‹¬ç«‹ç›å€¼

3. **åŒé‡ä¿æŠ¤**
   ```
   æ˜æ–‡å¯†ç  â†’ SHA256 â†’ bcrypt â†’ æ•°æ®åº“
   ```

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

- âœ… å½“å‰æ–¹æ¡ˆå·²è¶³å¤Ÿå®‰å…¨
- ğŸ”’ å¼ºçƒˆå»ºè®®å¯ç”¨ HTTPS
- ğŸ” å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- ğŸ“Š æ·»åŠ ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶
- ğŸš¨ æ·»åŠ å¼‚å¸¸ç™»å½•æ£€æµ‹

---

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æç¤º**ï¼š

1. **å·²æœ‰ç”¨æˆ·ä¸å—å½±å“** - åªè¦æ˜¯é€šè¿‡æ³¨å†Œé¡µé¢åˆ›å»ºçš„ç”¨æˆ·éƒ½æ˜¯æ­£ç¡®çš„
2. **ä¿®æ”¹å‰åˆ›å»ºçš„ç”¨æˆ·** - å¦‚æœä¹‹å‰é€šè¿‡ç®¡ç†å‘˜åˆ›å»ºè¿‡ç”¨æˆ·ï¼Œè¿™äº›ç”¨æˆ·å¯èƒ½æ— æ³•ç™»å½•ï¼Œéœ€è¦é‡ç½®å¯†ç 
3. **å¯†ç é‡ç½®** - ç®¡ç†å‘˜å¯ä»¥åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢ä¸ºç”¨æˆ·é‡ç½®å¯†ç 
4. **ä¸è¦ç›´æ¥æ“ä½œæ•°æ®åº“** - å¿…é¡»é€šè¿‡å‰ç«¯ç•Œé¢æ“ä½œï¼Œç¡®ä¿å¯†ç æ­£ç¡®åŠ å¯†

---

## å¿«é€ŸéªŒè¯è„šæœ¬

åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯åŠ å¯†æ˜¯å¦æ­£ç¡®ï¼š

```typescript
// test-encryption.ts
import { encryptPassword } from './frontend/src/utils/crypto';
import bcrypt from 'bcryptjs';

const testPassword = 'test123456';

// å‰ç«¯åŠ å¯†
const clientEncrypted = encryptPassword(testPassword);
console.log('1. å‰ç«¯åŠ å¯†:', clientEncrypted);

// åç«¯åŠ å¯†
const serverHashed = bcrypt.hashSync(clientEncrypted, 10);
console.log('2. åç«¯åŠ å¯†:', serverHashed);

// éªŒè¯
const isValid = bcrypt.compareSync(clientEncrypted, serverHashed);
console.log('3. éªŒè¯ç»“æœ:', isValid ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥');
```

---

**ä¿®å¤æ—¶é—´**: 2026å¹´2æœˆ15æ—¥  
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… å¾…æµ‹è¯•  
**å½±å“èŒƒå›´**: ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·åŠŸèƒ½
