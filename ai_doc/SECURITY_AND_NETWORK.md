# 安全性和网络访问配置说明

## 🔒 密码加密传输

### 实现方案
本系统采用**双重加密**策略保护用户密码：

1. **客户端加密**（传输层）
   - 使用 SHA256 + 固定盐值对密码进行加密
   - 防止密码明文在网络传输过程中被窃取
   - 加密算法：`SHA256(password + CRYPTO_SALT)`

2. **服务端加密**（存储层）
   - 使用 bcrypt 对客户端加密后的密码再次加密
   - 防止数据库泄露时密码被破解
   - 加密算法：`bcrypt(client_encrypted_password, 10)`

### 验证流程

#### 注册流程
```
用户输入密码 → 前端 SHA256 加密 → 发送到后端 → 后端 bcrypt 加密 → 存入数据库
```

#### 登录流程
```
用户输入密码 → 前端 SHA256 加密 → 发送到后端 → 后端 bcrypt 验证 → 返回 JWT Token
```

### 安全说明
⚠️ **重要提示**：
- 客户端加密只能防止传输过程中的明文泄露
- 如需更高安全性，建议配置 HTTPS/SSL 证书
- 生产环境务必使用 HTTPS 协议
- 不要在公网环境使用 HTTP 协议

---

## 🌐 外部访问配置

### 为什么需要修改配置？

默认情况下，前端使用 `localhost` 作为 API 地址：
- ✅ 在本机访问：正常工作
- ❌ 在其他设备访问：Connection refused（连接被拒绝）

**原因**：`localhost` 只能在本机访问，其他设备无法解析。

### 解决方案

#### 1. 查看本机 IP 地址

**macOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```bash
ipconfig
```

示例输出：`192.168.3.100`

#### 2. 修改前端配置

编辑 `/frontend/.env.development` 文件：

```bash
# 修改前（只能本机访问）
VITE_API_URL=http://localhost:3000/api

# 修改后（支持局域网访问）
VITE_API_URL=http://192.168.3.100:3000/api
```

> 将 `192.168.3.100` 替换为你的实际 IP 地址

#### 3. 重启前端服务

```bash
cd frontend
npm run dev
```

#### 4. 访问方式

修改后，可以通过以下方式访问：
- 本机：`http://localhost:5174` 或 `http://192.168.3.100:5174`
- 局域网内其他设备：`http://192.168.3.100:5174`

### 配置文件说明

| 文件 | 用途 | 何时生效 |
|------|------|---------|
| `.env.development` | 开发环境配置 | `npm run dev` 时 |
| `.env.production` | 生产环境配置 | `npm run build` 时 |
| `.env.example` | 配置模板 | 仅作为参考 |

### 常见问题

#### Q: 修改配置后仍然无法访问？
**A:** 请检查：
1. 是否重启了前端服务？（必须重启）
2. 后端是否监听 `0.0.0.0`？（已配置）
3. 防火墙是否开放了 3000 和 5174 端口？
4. 手机/其他设备是否与电脑在同一局域网？

#### Q: IP 地址会变化怎么办？
**A:** 两种解决方案：
1. **路由器绑定 IP**：在路由器管理界面为设备设置静态 IP
2. **使用域名**：配置本地 DNS 或使用内网穿透服务

#### Q: 如何在公网访问？
**A:** 开发环境不建议暴露到公网。生产环境请：
1. 部署到云服务器（阿里云、腾讯云等）
2. 配置 HTTPS 证书
3. 使用 Nginx 反向代理
4. 配置防火墙和安全组

---

## 📝 当前配置状态

### 后端配置
- 端口：`3000`
- 监听地址：`0.0.0.0`（支持外部访问）
- 默认管理员：`admin` / `admin123`

### 前端配置  
- 端口：`5174`
- 监听地址：`0.0.0.0`（支持外部访问）
- API 地址：`http://192.168.3.100:3000/api`

### 网络地址
本机可通过以下地址访问前端：
- http://localhost:5174
- http://192.168.3.100:5174
- http://192.168.3.99:5174
- http://10.211.55.2:5174
- http://10.37.129.2:5174
- http://100.92.42.1:5174

---

## 🚀 启动服务

### 后端
```bash
cd backend
npm run dev
```

### 前端
```bash
cd frontend
npm run dev
```

### 一键启动（可选）
创建 `start.sh` 脚本：
```bash
#!/bin/bash
# 启动后端
cd backend && npm run dev &
# 启动前端
cd ../frontend && npm run dev
```

---

## 🔐 安全建议

### 开发环境
- ✅ 当前配置适用于开发和局域网使用
- ⚠️ 不要在公共网络使用 HTTP 协议

### 生产环境
- ✅ 使用 HTTPS（必须）
- ✅ 修改默认管理员密码
- ✅ 配置环境变量（不要硬编码密钥）
- ✅ 启用速率限制和访问控制
- ✅ 定期更新依赖包

---

## 📚 相关文档
- [项目快速开始](./QUICKSTART.md)
- [前端开发指南](./FRONTEND_GUIDE.md)
- [完整功能列表](./COMPLETED_FEATURES.md)
